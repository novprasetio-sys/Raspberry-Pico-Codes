import network
import urequests
import machine
import time

# Inisialisasi pin
trig_pin = 2
echo_pin = 3
trig = machine.Pin(trig_pin, machine.Pin.OUT)
echo = machine.Pin(echo_pin, machine.Pin.IN)

# Inisialisasi WiFi
wifi = network.WLAN(network.STA_IF)
wifi.active(True)
wifi.connect('SSID', 'PASSWORD')

# Inisialisasi Thingspeak
thingspeak_api_key = 'YOUR_API_KEY'
thingspeak_url = 'https://api.thingspeak.com/update?api_key=' + thingspeak_api_key

def jarak():
    trig.value(0)
    time.sleep_us(2)
    trig.value(1)
    time.sleep_us(10)
    trig.value(0)
    while echo.value() == 0:
        pass
    start = time.ticks_us()
    while echo.value() == 1:
        pass
    end = time.ticks_us()
    jarak_cm = (end - start) / 58
    return jarak_cm

while True:
    try:
        # Baca data Ultrasonik
        jarak_cm = jarak()
        
        # Kirim data ke Thingspeak
        url = thingspeak_url + '&field1=' + str(jarak_cm)
        urequests.get(url)
        
        print('Jarak:', jarak_cm, 'cm')
    except Exception as e:
        print('Error:', e)
    time.sleep(15)